<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Admin index</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="icon" type="image/png" href="/static/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="/static/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
    <script src="/static/js/echarts.min.js"></script>
    <link rel="stylesheet" href="/static/css/amazeui.min.css"/>
    <link rel="stylesheet" href="/static/css/amazeui.datatables.min.css"/>
    <link rel="stylesheet" href="/static/css/app.css">
    <script src="/static/js/jquery.min.js"></script>
    <script src="https://unpkg.com/flyio/dist/fly.min.js"></script>
    <script src="/static/js/interceptors.js"></script>

    <style>
        .logo-div-height {
            height: 60px
        }

        .admin-logo {
            background-color: rgb(255, 255, 255)
        }
    </style>
</head>
<body data-type="widgets">
<script src="/static/js/theme.js"></script>
<div class="am-g tpl-g">
    <!-- 头部 -->
    <header>
        <!-- logo -->
        <div class="am-fl tpl-header-logo">
            <a href="javascript:;"><img src="/static/img/logo4.png" alt="logo" class="logo-div-height"></a>
        </div>
        <div class="am-fl tpl-header-switch-button am-icon-list">
                <span>

            </span>
        </div>
        <!-- 右侧内容 -->
        <div class="am-g tpl-g">
            <!-- 其它功能-->
            <div class="am-fr tpl-header-navbar">
                <ul>
                    <!-- 欢迎语 -->
                    <li class="am-text-sm tpl-header-navbar-welcome">
                        <a href="javascript:;">欢迎你, <span>User</span> </a>
                    </li>

                    <!-- 退出 -->
                    <li class="am-text-sm">
                        <a href="javascript:;" onclick="logout()">
                            <span class="am-icon-sign-out"></span> 退出
                        </a>
                    </li>
                </ul>
            </div>
        </div>

    </header>
    <!-- 风格切换 -->
    <div class="tpl-skiner">
        <div class="tpl-skiner-toggle am-icon-cog">
        </div>
        <div class="tpl-skiner-content">
            <div class="tpl-skiner-content-title">
                选择主题
            </div>
            <div class="tpl-skiner-content-bar">
                <span class="skiner-color skiner-white" data-color="theme-white"></span>
                <span class="skiner-color skiner-black" data-color="theme-black"></span>
            </div>
        </div>
    </div>
    <!-- 侧边导航栏 -->
    <div class="left-sidebar">
        <!-- 用户信息 -->
        <div class="tpl-sidebar-user-panel">
            <div class="tpl-user-panel-slide-toggleable">
                <div class="tpl-user-panel-profile-picture admin-logo">
                    <img src="/static/img/hou.jpg" alt="">
                    <!--
                    <embed src="/static/img/admin_logo.svg" type="image/svg+xml" class="admin-logo" />
                    -->
                </div>
                <span class="user-panel-logged-in-text">
                        <i class="am-icon-circle-o am-text-success tpl-user-panel-status-icon"></i>
                    User
                    </span>
                <!--
                <a href="javascript:;" class="tpl-user-panel-action-link"> <span class="am-icon-pencil"></span> 账号设置</a>
                -->
            </div>
        </div>


        <!-- 菜单 -->
        <ul class="sidebar-nav">
            <li class="sidebar-nav-heading">功能 <span class="sidebar-nav-heading-info"> 功能</span></li>
            {#                <li class="sidebar-nav-link">#}
            {#                    <a href="javascript:;" class="sidebar-nav-sub-title active">#}
            {#                        <i class="am-icon-wpforms sidebar-nav-link-logo"></i> 数据列表#}
            {#                        <span class="am-icon-chevron-down am-fr am-margin-right-sm sidebar-nav-sub-ico sidebar-nav-sub-ico-rotate"></span>#}
            {#                    </a>#}
            {#                    <ul class="sidebar-nav sidebar-nav-sub" style="display: block;">#}
            <li class="sidebar-nav-link">
                <a href="/user/index.html" class="sub-active">
                    <i class="am-icon-home sidebar-nav-link-logo"></i> 预订房间
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="/user/user_info.html" class="sub-active">
                    <i class="am-icon-gear sidebar-nav-link-logo"></i> 个人信息
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="/user/change_password.html" class="sub-active">
                    <i class="am-icon-key sidebar-nav-link-logo"></i> 修改密码
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="404.html" class="sub-active">
                    <i class="am-icon-tv sidebar-nav-link-logo"></i> 404错误
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="/user/my_book_info.html">
                    <i class="am-icon-university sidebar-nav-link-logo"></i> 预订信息
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="/user/my_order_info.html" class="sub-active">
                    <i class="am-icon-shopping-bag sidebar-nav-link-logo"></i> 我的订单
                </a>
            </li>
        </ul>
    </div>

    <!-- 内容区域 -->
    <div class="tpl-content-wrapper">
        <div class="row-content am-cf">
            <div class="row">
                <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                    <div class="widget am-cf">
                        <div class="widget-head am-cf">
                            <div class="widget-title am-cf">预订信息</div>


                        </div>
                        <div class="widget-body  am-fr">

                            <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <div class="am-form-group">
                                    <div class="am-btn-toolbar">
                                        <div class="am-btn-group am-btn-group-xs">
                                            <!-- <button type="button" class="am-btn am-btn-default am-btn-secondary"><span class="am-icon-save"></span> 保存</button>
                                            <button type="button" class="am-btn am-btn-default am-btn-warning"><span class="am-icon-archive"></span> 审核</button>
                                            <button type="button" class="am-btn am-btn-default am-btn-danger"><span class="am-icon-trash-o"></span> 删除</button>
                                            -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="am-u-sm-12">
                                <table width="100%" class="am-table am-table-compact am-table-striped tpl-table-black "
                                       id="example-r">
                                    <thead>
                                    <tr>
                                        {#                                                <th>单号</th>#}
                                        <th>开始时间</th>
                                        <th>结束时间</th>
                                        <th>是否取消预订</th>
                                        <th>预订用户id</th>
                                        <th>预订房间id</th>
                                        <th>预订状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody id="list">

                                    <!-- more data -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="am-u-lg-12 am-cf">

                                <div class="am-fr">
                                    <ul class="am-pagination tpl-pagination" id="next_page">
                                        <!--<li class="am-disabled"><a href="#">«</a></li>-->
                                        <!--
                                        <li class="am-active"><a href="#">1</a></li>
                                        <li><a href="#">2</a></li>
                                        <li><a href="#">3</a></li>
                                        <li><a href="#">4</a></li>
                                        <li><a href="#">5</a></li>
                                        -->
                                        <!--<li><a href="#">»</a></li>-->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!--模态框-->
<div class="am-modal am-modal-alert" tabindex="-1" id="post1">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">入住登记</div>
        <div class="am-modal-bd">
            <!--模态框内容-->
            <div style="text-align: center;">
                <table border="0" style="margin: auto" width='100%'>
                    <tr>
                        <td>预订用户:</td>
                        <td><input type="text" class="am-modal-prompt-input" id="uno" readonly/></td>
                    </tr>
                    <tr>
                        <td>预订房间:</td>
                        <td><input type="text" class="am-modal-prompt-input" id="rno" readonly/></td>
                    </tr>
                    <tr>
                        <td>开始时间:</td>
                        <td><input type="text" class="am-modal-prompt-input" id="start_time" readonly/></td>
                    </tr>
                    <tr>
                        <td>结束时间:</td>
                        <td><input type="text" class="am-modal-prompt-input" id="end_time" readonly/></td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="am-modal-footer">
            <!--关键是在这里为两个按钮加上data-am-modal-confirm与data-am-modal-cancel属性 class="am-modal-btn" -->
            <span class="am-btn am-btn-primary am-btn-block" id="post_btn1" onclick="post1(false, null)">提交</span>
            <span class="am-modal-btn">取消</span>
        </div>
    </div>
</div>

<!--模态框-->
<div class="am-modal am-modal-alert" tabindex="-1" id="post2">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">退订房间</div>
        <div class="am-modal-bd">
            <!--模态框内容-->
            <div style="text-align: center;">
                <table border="0" style="margin: auto" width='100%'>
                    {#                        <tr>#}
                    {#                            <td>预订用户:</td>#}
                    {#                            <td><input type="text" class="am-modal-prompt-input" id="uno"/></td>#}
                    {#                        </tr>#}
                    <tr>
                        <td>身份证号码:</td>
                        <td><input type="text" class="am-modal-prompt-input" id="id_card2"/></td>
                    </tr>
                    {#                        <tr>#}
                    {#                            <td>开始时间:</td>#}
                    {#                            <td><input type="text" class="am-modal-prompt-input" id="start_time"/></td>#}
                    {#                        </tr>#}
                    <tr>
                        <td>结束时间:</td>
                        <td><input type="text" class="am-modal-prompt-input" id="end_time"/></td>
                    </tr>
                    {#                        <tr>#}
                    {#                            <td>预订房间:</td>#}
                    {#                            <td><input type="text" class="am-modal-prompt-input" id="rno"/></td>#}
                    {#                        </tr>#}
                </table>
            </div>
        </div>
        <div class="am-modal-footer">
            <!--关键是在这里为两个按钮加上data-am-modal-confirm与data-am-modal-cancel属性 class="am-modal-btn" -->
            <span class="am-btn am-btn-primary am-btn-block" id="post_btn2" onclick="post2(false, null)">提交</span>
            <span class="am-modal-btn">取消</span>
        </div>
    </div>
</div>

<!--模态框-->
<div class="am-modal am-modal-confirm" tabindex="-1" id="delete_confirm">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">User</div>
        <div class="am-modal-bd">
            你，确定要删除这条记录吗？
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-cancel>取消</span>
            <span class="am-modal-btn" data-am-modal-confirm>确定</span>
        </div>
    </div>
</div>

<script src="/static/js/amazeui.min.js"></script>
<script src="/static/js/amazeui.datatables.min.js"></script>
<script src="/static/js/dataTables.responsive.min.js"></script>
<script src="/static/js/app.js"></script>

</body>
<script type="text/javascript">
    var api_url = "/api/user/my_book_info"

    function insert(page, size) {
        $("#list").html("")
        fly.get(
            api_url,
            {
                "page": page,
                "size": size,
            },
            console.log(page, 111111)
        ).then(
            function (response) {
                // console.log(response,111111)
                let infos = response.data.infos
                console.log(infos, 4560000000000000)
                insert_tr(infos)
                insert_page(response.data.page.current, response.data.page.total)
            }
        ).catch(
            function (error) {
                console.log(error)
            }
        )
    }

    function logout() {
        fly.delete(
            "/api/admin/logout",
        ).then(
            function (response) {
                console.log(response)
            }
        ).catch(
            function (error) {
                console.log(error)
            }
        )
    }

    function insert_page(current, total) {
        console.log("insert_page", current, total)
        $("#next_page").html("")

        for (var i = 0; i < total; i++) {
            let page = i + 1
            var page_str = '<li><a href="javascript:" onclick="insert(' + page + ', ' + 10 + ')">' + page + '</a></li>'
            if (page == current) {
                page_str = '<li class="am-active"><a href="javascript:">'
                    + page + '</a></li>'
            }
            $("#next_page").append(page_str)
            // console.log("page_str: ", page_str)
        }
    }

    insert(1, 10)

    function insert_tr(name_list) {
        let tr_list = ""
        console.log("=======---=======> ", name_list)
        // name_list.forEach()
        for (var index in name_list) {
            let id = name_list[index]["id"]
            let start_time = name_list[index]["start_time"]
            let end_time = name_list[index]["end_time"]
            let is_cancel = name_list[index]["is_cancel"]
            let uno = name_list[index]["uno"]
            let rno = name_list[index]["rno"]
            {#let id_card1 = name_list[index]["id_card1"]#}
            {#let id_card2 = name_list[index]["id_card2"]#}
            let status = name_list[index]["status"]
            let tr = '\
                <td>\
                    <div class="tpl-table-black-operation">\
                        <a href="javascript:;" onclick="edit1(' + "'" + start_time + "', '" + uno + "','" + rno + "','" + end_time + "'," + id + ')">\
                            <i class="am-icon-pencil"></i> 取消预订\
                        </a>\
                        <a href="javascript:;" class="tpl-table-black-operation-del" onclick="delete_modal(' + id + ')">\
                            <i class="am-icon-trash"></i> 删除\
                        </a>\
                    </div>\
                </td>\
                </tr>\
            '
            let insert_str = '\
                <tr id="tr_' + id + '">\
                <td id="start_time_' + id + '">' + start_time + '</td>\
                <td id="end_time_' + id + '">' + end_time + '</td>\
                <td id="is_cancel_' + id + '">' + is_cancel + '</td>\
                <td id="uno_' + id + '">' + uno + '</td>\
                <td id="rno_' + id + '">' + rno + '</td>\
                <td id="status_' + id + '">' + status + '</td>'
                {#<td id="cno_' + id + '">' + cno + '</td>'#}
                + tr
            tr_list += insert_str
        }
        // console.log(tr_list)
        $("#list").append(tr_list)

    }

    {# 编辑框 #}

    function edit1(start_time, uno, rno, end_time, id) {
        console.log(name, id, 999999)
        console.log("edit: ", id, 8888)
        $("#post_btn1").attr("onclick", "post1(true, " + id + ")")
        $("#start_time").val($("#start_time_" + id).text())
        $("#end_time").val($("#end_time_" + id).text())
        $("#uno").val($("#uno_" + id).text())
        $("#rno").val($("#rno_" + id).text())
        $('#post1').modal("open")
    }

    function edit2(uno, id_card2, start_time, end_time, rno, id) {
        console.log("edit-------------start_time: ", start_time, 6666)
        console.log("edit-------------id: ", id, 8888)
        console.log("edit-------------id_card: ", id_card2, 8888)
        $("#post_btn2").attr("onclick", "post2(true, " + id + ")")
        $("#uno").val($("#uno_" + id).text())
        $("#id_card2").val($("#id_card2_" + id).text())
        $("#start_time").val($("#start_time_" + id).text())
        $("#end_time").val($("#end_time_" + id).text())
        $("#rno").val($("#rno_" + id).text())
        $('#post2').modal("open")
    }

    function delete_modal(id) {
        $('#delete_confirm').modal(
            {
                relatedTarget: this,
                onConfirm: function (e) {
                    delete_(id)
                },
                onCancel: function (e) {
                    console.log(e)
                    // alert('不想说!');
                }
            }
        )
    }

    function delete_(id) {
        console.log("delete_: ", id)
        fly.delete(
            api_url,
            {
                "id": id,
            },
            // {
            //     parseJson: true,
            //     headers: {"Content-Type": "application/json"}
            // }
        ).then(
            function (response) {
                console.log(response)
                $("#tr_" + id).remove()
            }
        ).catch(
            function (error) {
                console.log(error)
                if (error.response.data.error) {
                    alert(error.response.data.error)
                }
            }
        )
        // $('#post').modal("open")
    }

    function post1(is_edit, id) {
        console.log(is_edit, id, 55)
        let start_time = $("#start_time").val()
        let end_time = $("#end_time").val()
        let uno = $("#uno").val()
        let rno = $("#rno").val()
        {#let method = "post"#}
        // let id = null
        if (is_edit) {
            method = "post"
        }
        fly.request(
            "/api/user/my_book_info",
            {
                "start_time": start_time,
                "end_time": end_time,
                "uno": uno,
                "rno": rno,
            },
            {
                "method": method,
            }
        ).then(
            function (response) {
                info = response.data
                console.log(info, 11111111111111111)
                if (!is_edit) {
                    insert_tr(
                        [
                            {
                                "id": info.id,
                                "start_time": info.start_time,
                                "end_time": info.end_time,
                                "is_cancel": info.is_cancel,
                                "uno": info.uno,
                                "rno": info.rno,
                                "id_card1": info.id_card1,
                            }
                        ]
                    )
                } else {
                    $("#start_time_" + id).html(info.start_time)
                    $("#end_time_" + id).html(info.end_time)
                    $("#uno_" + id).html(info.uno)
                    $("#rno_" + id).html(info.rno)
                }
                $('#post1').modal("close")
            }
        ).catch(
            function (error) {
                console.log(error)
                {#alert(error.response.data.error)#}
            }
        )
    }

    function post2(is_edit, id) {
        console.log(is_edit, id, 55)
        let uno = $("#uno").val()
        let id_card2 = $("#id_card2").val()
        let start_time = $("#start_time").val()
        let end_time = $("#end_time").val()
        let rno = $("#rno").val()
        console.log("edit-------------: ", start_time, 8888)
        console.log("edit-------------: ", end_time, 9999)
        console.log("edit-------------: ", id_card2, 8888)
        {#let method = "post"#}
        // let id = null
        if (is_edit) {
            method = "post"
        }
        fly.request(
            "/api/admin/create_room_order",
            {
                "uno": uno,
                "id_card2": id_card2,
                "start_time": start_time,
                "end_time": end_time,
                "rno": rno,
            },
            {
                "method": method,
            }
        ).then(
            function (response) {
                info = response.data
                console.log(info, 11111111111111111)
                if (!is_edit) {
                    insert_tr(
                        [
                            {
                                "id": info.id,
                                "start_time": info.start_time,
                                "end_time": info.end_time,
                                "is_cancel": info.is_cancel,
                                "uno": info.uno,
                                "rno": info.rno,
                                "id_card2": info.id_card2,
                            }
                        ]
                    )
                } else {
                    $("#uno_" + id).html(info.uno)
                    $("#id_card2_" + id).html(info.id_card2)
                    $("#start_time_" + id).html(info.start_time)
                    $("#end_time_" + id).html(info.end_time)
                    $("#rno_" + id).html(info.rno)
                }
                $('#post2').modal("close")
            }
        ).catch(
            function (error) {
                console.log(error)
                {#alert(error.response.data.error)#}
            }
        )
    }

</script>

</html>